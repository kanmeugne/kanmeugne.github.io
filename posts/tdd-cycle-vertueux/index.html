<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Introduction au TDD (II) : le cycle vertueux" /><meta name="author" content="Patrick S. Kanmeugne" /><meta property="og:locale" content="en" /><meta name="description" content="Dans la première partie de cet exercice, je me suis concentré sur la mise en place de l’espace de travail et la validation du test zero (qui est tout simplement la compilation). On va se concentrer maintenant sur l’implémentation des fonctionnalités de la lib témoin. On verra en quoi l’approche TDD permet d’envisager sereinement l’évolution du code et le refactoring." /><meta property="og:description" content="Dans la première partie de cet exercice, je me suis concentré sur la mise en place de l’espace de travail et la validation du test zero (qui est tout simplement la compilation). On va se concentrer maintenant sur l’implémentation des fonctionnalités de la lib témoin. On verra en quoi l’approche TDD permet d’envisager sereinement l’évolution du code et le refactoring." /><link rel="canonical" href="https://kanmeugne.github.io/posts/tdd-cycle-vertueux/" /><meta property="og:url" content="https://kanmeugne.github.io/posts/tdd-cycle-vertueux/" /><meta property="og:site_name" content="Kanmeugne’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-29T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Introduction au TDD (II) : le cycle vertueux" /><meta name="twitter:site" content="@patricksimok" /><meta name="twitter:creator" content="@patricksimok" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Patrick S. Kanmeugne","url":"http://kanmeugne.github.io/"},"dateModified":"2022-05-25T21:11:44+08:00","datePublished":"2021-10-29T00:00:00+08:00","description":"Dans la première partie de cet exercice, je me suis concentré sur la mise en place de l’espace de travail et la validation du test zero (qui est tout simplement la compilation). On va se concentrer maintenant sur l’implémentation des fonctionnalités de la lib témoin. On verra en quoi l’approche TDD permet d’envisager sereinement l’évolution du code et le refactoring.","headline":"Introduction au TDD (II) : le cycle vertueux","mainEntityOfPage":{"@type":"WebPage","@id":"https://kanmeugne.github.io/posts/tdd-cycle-vertueux/"},"url":"https://kanmeugne.github.io/posts/tdd-cycle-vertueux/"}</script><title>Introduction au TDD (II) : le cycle vertueux | Kanmeugne's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Kanmeugne's Blog"><meta name="application-name" content="Kanmeugne's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/0.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Kanmeugne's Blog</a></div><div class="site-subtitle font-italic">stigmergy matters</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/kanmeugne" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/patricksimok" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['patrick.simokanmeugne','outlook.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Introduction au TDD (II) : le cycle vertueux</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Introduction au TDD (II) : le cycle vertueux</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1635436800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 29, 2021 </em> </span> <span> Updated <em class="" data-ts="1653484304" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 25, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="http://kanmeugne.github.io/">Patrick S. Kanmeugne</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2276 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><p>Dans la <a href="/posts/introduction-tdd-googletest" title="Introduction au TDD (I) : Mise en place avec googletest">première partie</a> de cet exercice, je me suis concentré sur la mise en place de l’espace de travail et la validation du test zero (qui est tout simplement la compilation). On va se concentrer maintenant sur l’implémentation des fonctionnalités de la lib témoin. On verra en quoi l’approche TDD permet d’envisager sereinement l’évolution du code et le refactoring.</p><p><img data-src="/images/test12-unsplash.jpg" alt="Introduction au TDD Poster" width="500" data-proofer-ignore> <em>Photo by <a href="https://unsplash.com/@itsliamtucker?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Liam Tucker</a> on <a href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></em></p><h2 id="le-mindset"><span class="mr-2">Le mindset</span><a href="#le-mindset" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Pour rappel, le <a href="/posts/introduction-tdd-googletest" title="Introduction au TDD (I) : Mise en place avec googletest">developpeur TDD</a> respecte le cycle suivant :</p><ol><li>Écrire des petits tests<li>S’assurer que les tests échouent dans un premier temps<li>Écrire le code qui permet passer le test<li>S’assurer que le test passe<li>Nettoyer (ou réfactorer) le code<li>S’assurer que le test passe toujours<li>Retourner à l’étape 1.</ol><p>La particularité de cette approche est qu’on définit les tests en premier lieu — la production de code a pour objectif de les valider.</p><h2 id="le-premier-test"><span class="mr-2">Le premier test</span><a href="#le-premier-test" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Pour commencer la production de notre lib <em>toolset</em>, il faut donc prélablement définir un test qui est sensé échouer dans l’état actuel du code. Commençons par le test ci-dessous :</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">ParserTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Test</span><span class="p">{};</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">ParserTest</span><span class="p">,</span> <span class="n">Parser_LowerSingleLetter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">input</span> <span class="o">=</span> <span class="s">"L"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">expected</span> <span class="o">=</span> <span class="s">"l"</span><span class="p">;</span>
    <span class="n">MyParser</span> <span class="n">parser</span><span class="p">;</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">convertToLowerCase</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
	<span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s">"l"</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</pre></table></code></div></div><blockquote class="prompt-tip"><div><p><strong>Traduction en langage naturel</strong> : La fonction <code class="language-plaintext highlighter-rouge">convertToLowerCase</code> du parser convertit la lettre “L” majuscule en “l” minuscule</p></div></blockquote><p>Quelques mots clefs dans cette définition nécessitent une petite explication :</p><ul><li><code class="language-plaintext highlighter-rouge">TEST</code> est la macro <em>googletest</em> qui permet de définir un test unitaire. <code class="language-plaintext highlighter-rouge">ASSERT_EQ</code> est une autre MACRO qui permet de tester si 2 variables ont la même valeur (voir la <a href="https://github.com/google/googletest" title="GoogleTest is Google’s C++ testing and mocking framework">documentation de googletest</a> pour plus d’infos sur les macros disponibles).<li>La déclaration de la classe <code class="language-plaintext highlighter-rouge">ParserTest</code> (dérivée de <code class="language-plaintext highlighter-rouge">testing::Test</code>) permet de regrouper les tests par thématique — comme on le verra plus bas, ce mécanisme permet aussi de définir des <a href="https://github.com/google/googletest" title="GoogleTest is Google’s C++ testing and mocking framework">fixtures</a>.<li><code class="language-plaintext highlighter-rouge">Parser_LowerSingleLetter</code> : est le nom du test. Très utile quand il faudra lire les résultats des tests sur la console.</ul><p>Le test défini ci-dessus est simple (une assertion) avec un objectif exprimable en langage naturel : <em>le parseur doit transformer la lettre L (majuscule) en la lettre l (minuscule)</em>. Produisons maintenant le code qui permet de le valider.</p><h2 id="la-première-validation"><span class="mr-2">La première validation</span><a href="#la-première-validation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Pour l’instant le test échoue à cause d’un problème de compilation puisque la classe <code class="language-plaintext highlighter-rouge">MyParser</code> n’est pas vraiment définie. En écrivant le strict minimum dans <code class="language-plaintext highlighter-rouge">MyParser.h</code> pour que la compilation fonctionne,</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">"MyParser.h"</span><span class="cp">
</span>
<span class="c1">//MyParser::convertToLowerCase</span>
<span class="kt">void</span> <span class="n">MyParser</span><span class="o">::</span><span class="n">convertToLowerCase</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">output</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//MyParser::MyParser</span>
<span class="n">MyParser</span><span class="o">::</span><span class="n">MyParser</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="c1">//MyParser::~MyParser</span>
<span class="n">MyParser</span><span class="o">::~</span><span class="n">MyParser</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></table></code></div></div><p>on obtient un message d’erreur plus conventionnel :</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="o">[==========]</span> Running 1 <span class="nb">test </span>from 1 <span class="nb">test </span>suite.
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> Global <span class="nb">test </span>environment set-up.
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> 1 <span class="nb">test </span>from ParserTest
<span class="o">[</span> RUN      <span class="o">]</span> ParserTest.Parser_LowerSingleLetter
/.../tests/src/main.cpp:15: Failure
Expected equality of these values:
  output
    Which is: <span class="s2">""</span>
  <span class="s2">"l"</span>
<span class="o">[</span>  FAILED  <span class="o">]</span> ParserTest.Parser_LowerSingleLetter <span class="o">(</span>0 ms<span class="o">)</span>
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> 1 <span class="nb">test </span>from ParserTest <span class="o">(</span>0 ms total<span class="o">)</span>

<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> Global <span class="nb">test </span>environment tear-down
<span class="o">[==========]</span> 1 <span class="nb">test </span>from 1 <span class="nb">test </span>suite ran. <span class="o">(</span>0 ms total<span class="o">)</span>
<span class="o">[</span>  PASSED  <span class="o">]</span> 0 tests.
<span class="o">[</span>  FAILED  <span class="o">]</span> 1 <span class="nb">test</span>, listed below:
<span class="o">[</span>  FAILED  <span class="o">]</span> ParserTest.Parser_LowerSingleLetter

 1 FAILED TEST
</pre></table></code></div></div><p>En d’autre termes, le test <code class="language-plaintext highlighter-rouge">Parser_LowerSingleLetter</code> échoue car la valeur obtenue par le <em>parser</em> — la chaine de caractère vide — ne correspond pas à la valeur attendue — “l”.</p><p>Pour que le test soit validé, il faut produire une implémentation correcte de la fonction <code class="language-plaintext highlighter-rouge">MyParser::convertToLowerCase</code> dans <code class="language-plaintext highlighter-rouge">MyParser.cpp</code>. Pour cela, disons que la fonction <strong>parcourt la chaine de caractères, transforme en minuscules tous les caractères et les rajoute dans la variable de sortie</strong>. Ce qui nous donne l’implémentation suivante :</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">//MyParser::convertToLowerCase</span>
<span class="kt">void</span> <span class="n">MyParser</span><span class="o">::</span><span class="n">convertToLowerCase</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">output</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">c</span> <span class="o">:</span> <span class="n">input</span><span class="p">)</span>
        <span class="n">output</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tolower</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Avec cette implémentation, le test est OK. On a produit le code qui valide notre premier test unitaire — je laisse au lecteur le soin de rajouter d’autres tests sur cette première fonction pour éprouver le code s’il le souhaite.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="o">[==========]</span> Running 1 <span class="nb">test </span>from 1 <span class="nb">test </span>suite.
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> Global <span class="nb">test </span>environment set-up.
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> 1 <span class="nb">test </span>from ParserTest
<span class="o">[</span> RUN      <span class="o">]</span> ParserTest.Parser_LowerSingleLetter
<span class="o">[</span>       OK <span class="o">]</span> ParserTest.Parser_LowerSingleLetter <span class="o">(</span>0 ms<span class="o">)</span>
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> 1 <span class="nb">test </span>from ParserTest <span class="o">(</span>0 ms total<span class="o">)</span>

<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> Global <span class="nb">test </span>environment tear-down
<span class="o">[==========]</span> 1 <span class="nb">test </span>from 1 <span class="nb">test </span>suite ran. <span class="o">(</span>0 ms total<span class="o">)</span>
<span class="o">[</span>  PASSED  <span class="o">]</span> 1 test.
</pre></table></code></div></div><blockquote class="prompt-tip"><div><p>La production de code valide le test, on peut avancer dans le développement.</p></div></blockquote><h2 id="red-green-refactor"><span class="mr-2">Red, Green, Refactor</span><a href="#red-green-refactor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ecrivons notre deuxième test pour la deuxième fonction :</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">TEST</span><span class="p">(</span><span class="n">ParserTest</span><span class="p">,</span> <span class="n">Parser_UpperSingleLetter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">input</span> <span class="o">=</span> <span class="s">"l"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">expected</span> <span class="o">=</span> <span class="s">"L"</span><span class="p">;</span>
    <span class="n">MyParser</span> <span class="n">parser</span><span class="p">;</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">convertToUpperCase</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
	<span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s">"L"</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Comme le premier, le deuxième test échoue puisque la fonction <code class="language-plaintext highlighter-rouge">MyParser::convertToUpperCase</code> n’est pas définie. Effectuons les modifications de code qui permettent de valider le test.</p><p>Tout d’abord, la mise à jour des définitions dans le fichier <code class="language-plaintext highlighter-rouge">./toolset/include/MyParser.h</code>,</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">MyParser</span>
<span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">MyParser</span><span class="p">();</span>
    <span class="o">~</span><span class="n">MyParser</span><span class="p">();</span>

    <span class="kt">void</span> <span class="n">convertToLowerCase</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
    <span class="kt">void</span> <span class="n">convertToUpperCase</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="p">};</span>
</pre></table></code></div></div><p>puis l’implémentation de la fonction <code class="language-plaintext highlighter-rouge">convertToUpperCase</code> dans le fichier <code class="language-plaintext highlighter-rouge">./toolset/src/MyParser.cpp</code>,</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">//MyParser::convertToUpperCase</span>
<span class="kt">void</span> <span class="n">MyParser</span><span class="o">::</span><span class="n">convertToUpperCase</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">output</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">c</span> <span class="o">:</span> <span class="n">input</span><span class="p">)</span>
        <span class="n">output</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">toupper</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
<span class="p">}</span>
</pre></table></code></div></div><p>L’exécution des tests renvoie maintenant le résultat suivant :</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="o">[==========]</span> Running 2 tests from 1 <span class="nb">test </span>suite.
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> Global <span class="nb">test </span>environment set-up.
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> 2 tests from ParserTest
<span class="o">[</span> RUN      <span class="o">]</span> ParserTest.Parser_LowerSingleLetter
<span class="o">[</span>       OK <span class="o">]</span> ParserTest.Parser_LowerSingleLetter <span class="o">(</span>0 ms<span class="o">)</span>
<span class="o">[</span> RUN      <span class="o">]</span> ParserTest.Parser_UpperSingleLetter
<span class="o">[</span>       OK <span class="o">]</span> ParserTest.Parser_UpperSingleLetter <span class="o">(</span>0 ms<span class="o">)</span>
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> 2 tests from ParserTest <span class="o">(</span>0 ms total<span class="o">)</span>

<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> Global <span class="nb">test </span>environment tear-down
<span class="o">[==========]</span> 2 tests from 1 <span class="nb">test </span>suite ran. <span class="o">(</span>0 ms total<span class="o">)</span>
<span class="o">[</span>  PASSED  <span class="o">]</span> 2 tests.
</pre></table></code></div></div><p>On voit que le premier test reste valide — ce qui signifie qu’il n’y a pas eu de regression — et que le deuxième test est également OK. La logique de production est toujours la même et peut se résumer en une formule synthétique : <strong>Red</strong>, <strong>Green</strong>, <strong>Refactor</strong> :</p><ul><li><strong>Red</strong> (le test échoue d’abord),<li><strong>Green</strong> (le test passe après une modification du code, tous les tests précédents doivent toujours être valides)<li><strong>Refactor</strong> (on restructure le code pour une cohérence d’ensemble et on revérifie que tous les tests passent toujours)</ul><p>On remarque le cycle vertueux qui oblige à avancer lentement mais surement en faisant le moins de dégâts possible.</p><h2 id="cas-dusage-de-refactoring"><span class="mr-2">Cas d’usage de Refactoring</span><a href="#cas-dusage-de-refactoring" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>L’approche <em>TDD</em> se prête également bien aux tâches de refactoring pures. Dans ces cas, on profite des tests déjà définis pour controler la qualité du code.</p><p>Pour notre exemple, essayons un refactoring en deux étapes :</p><ol><li>Création d’un namespace <code class="language-plaintext highlighter-rouge">utils</code>, qui contiendra les définitions de la classe <code class="language-plaintext highlighter-rouge">MyParser</code>.<li>Ajout d’une fonction dans la bibliothèque qui renvoie une instance unique de <code class="language-plaintext highlighter-rouge">MyParser</code></ol><h3 id="refactoring-1--ajouter-un-namespace"><span class="mr-2">Refactoring 1 : ajouter un namespace</span><a href="#refactoring-1--ajouter-un-namespace" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Pour la première étape, modifions tout d’abord les tests qui doivent valider le code. La logique des tests n’est pas modifiée — ce qui serait une faute grave — juste l’initialisation du <em>parser</em>.</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="n">TEST</span><span class="p">(</span><span class="n">ParserTest</span><span class="p">,</span> <span class="n">Parser_LowerSingleLetter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">input</span> <span class="o">=</span> <span class="s">"L"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">expected</span> <span class="o">=</span> <span class="s">"l"</span><span class="p">;</span>
    <span class="n">utils</span><span class="o">::</span><span class="n">MyParser</span> <span class="n">parser</span><span class="p">;</span> <span class="c1">// namespace utils</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">convertToLowerCase</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
	<span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s">"l"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">ParserTest</span><span class="p">,</span> <span class="n">Parser_UpperSingleLetter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">input</span> <span class="o">=</span> <span class="s">"l"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">expected</span> <span class="o">=</span> <span class="s">"L"</span><span class="p">;</span>
    <span class="n">utils</span><span class="o">::</span><span class="n">MyParser</span> <span class="n">parser</span><span class="p">;</span> <span class="c1">// namespace utils</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">convertToUpperCase</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
	<span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s">"L"</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Naturellement — et heureusement — ces tests échouent dans un premier temps puisque <code class="language-plaintext highlighter-rouge">MyParser.h</code> n’est pas défini dans le bon namespace. Les modifications suivantes vont permettre de les valider.</p><p>D’abord le fichier <code class="language-plaintext highlighter-rouge">./toolset/include/MyParser.h</code>,</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="cp">#ifndef MYPARSER_H
#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span>
<span class="k">namespace</span> <span class="n">utils</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">MyParser</span>
    <span class="p">{</span>
    <span class="nl">public:</span>
        <span class="n">MyParser</span><span class="p">();</span>
        <span class="o">~</span><span class="n">MyParser</span><span class="p">();</span>

        <span class="kt">void</span> <span class="n">convertToLowerCase</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
        <span class="kt">void</span> <span class="n">convertToUpperCase</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span> <span class="c1">// namespace utils</span>
<span class="cp">#endif // MYPARSER_H
</span></pre></table></code></div></div><p>Puis le fichier <code class="language-plaintext highlighter-rouge">./toolset/src/MyParser.cpp</code>, dans lequel il suffira de rajouter la ligne ci-dessous :</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="k">namespace</span> <span class="n">utils</span><span class="p">;</span>
</pre></table></code></div></div><p>Les tests refonctionnent! Refactoring réussi en toute sérénité.</p><p>Maintenant voyons pour le deuxième refactoring.</p><h3 id="refactoring-2-utiliser-une-référence-unique"><span class="mr-2">Refactoring 2: utiliser une référence unique</span><a href="#refactoring-2-utiliser-une-référence-unique" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Pour la deuxième étape du refactoring, l’idée est de rajouter une fonction — <code class="language-plaintext highlighter-rouge">utils::getParser</code> — qui renvoie une instance unique de <code class="language-plaintext highlighter-rouge">MyParser</code>. On testera cette fonction en utilisant une nouvelle classe dans le fichier <code class="language-plaintext highlighter-rouge">./tests/main.cpp</code> :</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">//Les fixtures sont des attributs publiques des classes Test</span>
<span class="k">class</span> <span class="nc">UniqueParserTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Test</span>
<span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">utils</span><span class="o">::</span><span class="n">MyParser_t</span> <span class="o">&amp;</span><span class="n">_parser</span><span class="p">;</span>

    <span class="n">UniqueParserTest</span><span class="p">()</span><span class="o">:</span><span class="n">_parser</span><span class="p">(</span><span class="n">utils</span><span class="o">::</span><span class="n">getParser</span><span class="p">())</span> <span class="p">{}</span>
<span class="p">};</span>
</pre></table></code></div></div><p>La classe <code class="language-plaintext highlighter-rouge">UniqueParserTest</code> définit une fixture <code class="language-plaintext highlighter-rouge">UniqueParserTest::_parser</code> qui est initialisée dans <code class="language-plaintext highlighter-rouge">UniqueParserTest::UniqueParserTest()</code>.</p><p>Les tests <code class="language-plaintext highlighter-rouge">UniqueParserTest</code> vont permettre de valider, d’une part, que la fonction <code class="language-plaintext highlighter-rouge">utils::getParseur</code> retoune toujours la même instance, et d’autre part, que toutes les fonctionnalités du parseur sont bien validées par cette instance.</p><p>On définit les nouveaux tests suivants — on notera l’utilisation de la macro <code class="language-plaintext highlighter-rouge">TEST_F</code> à la place de <code class="language-plaintext highlighter-rouge">TEST</code>, ce qui permet exploiter les fixtures dans le test :</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="n">TEST_F</span><span class="p">(</span><span class="n">UniqueParserTest</span><span class="p">,</span> <span class="n">Parser_UniqueParserIsUnique</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">utils</span><span class="o">::</span><span class="n">MyParser_t</span><span class="o">&amp;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">utils</span><span class="o">::</span><span class="n">getParser</span><span class="p">();</span>
    <span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">addressof</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">addressof</span><span class="p">(</span><span class="n">_parser</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">UniqueParserTest</span><span class="p">,</span> <span class="n">Parser_UniqueParserLowerSingleLetter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">input</span> <span class="o">=</span> <span class="s">"L"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">expected</span> <span class="o">=</span> <span class="s">"l"</span><span class="p">;</span>
    <span class="n">_parser</span><span class="o">-&gt;</span><span class="n">convertToLowerCase</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
    <span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s">"l"</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">UniqueParserTest</span><span class="p">,</span> <span class="n">Parser_UniqueParserUpperSingleLetter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">input</span> <span class="o">=</span> <span class="s">"l"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">expected</span> <span class="o">=</span> <span class="s">"L"</span><span class="p">;</span>
    <span class="n">_parser</span><span class="o">-&gt;</span><span class="n">convertToUpperCase</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
    <span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s">"L"</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>On notera que le test prévoit l’utilisation du type <code class="language-plaintext highlighter-rouge">MyParser_t</code> – à définir dans le code à produire – pour stocker l’instance unique de <code class="language-plaintext highlighter-rouge">MyParser</code>.</p><p>Bonne nouvelle, les tests échouent dans un premier temps, puis (après plusieurs essais), les modifications suivantes permettent de les valider.</p><p>Tout d’abord le fichier <code class="language-plaintext highlighter-rouge">MyParser.h</code> :</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">#ifndef MYPARSER_H
#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span>
<span class="k">namespace</span> <span class="n">utils</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">MyParser</span>
    <span class="p">{</span>
    <span class="nl">public:</span>
        <span class="n">MyParser</span><span class="p">();</span>
        <span class="o">~</span><span class="n">MyParser</span><span class="p">();</span>

        <span class="kt">void</span> <span class="n">convertToLowerCase</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
        <span class="kt">void</span> <span class="n">convertToUpperCase</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">MyParser</span><span class="o">&gt;</span> <span class="n">MyParser_t</span><span class="p">;</span>

    <span class="n">MyParser_t</span><span class="o">&amp;</span> <span class="n">getParser</span><span class="p">();</span>
<span class="p">}</span> <span class="c1">// namespace utils</span>
<span class="cp">#endif // MYPARSER_H
</span></pre></table></code></div></div><p>puis, le fichier <code class="language-plaintext highlighter-rouge">MyParser.cpp</code> :</p><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">"MyParser.h"</span><span class="cp">
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">utils</span><span class="p">;</span>

<span class="c1">//MyParser::convertToLowerCase</span>
<span class="kt">void</span> <span class="n">MyParser</span><span class="o">::</span><span class="n">convertToLowerCase</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">output</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">c</span> <span class="o">:</span> <span class="n">input</span><span class="p">)</span>
        <span class="n">output</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tolower</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
<span class="p">}</span>
<span class="c1">//MyParser::convertToUpperCase</span>
<span class="kt">void</span> <span class="n">MyParser</span><span class="o">::</span><span class="n">convertToUpperCase</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">output</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">c</span> <span class="o">:</span> <span class="n">input</span><span class="p">)</span>
        <span class="n">output</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">toupper</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
<span class="p">}</span>
<span class="c1">//MyParser::MyParser</span>
<span class="n">MyParser</span><span class="o">::</span><span class="n">MyParser</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="c1">//MyParser::~MyParser</span>
<span class="n">MyParser</span><span class="o">::~</span><span class="n">MyParser</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="c1">//MyParser_t&amp; utils::getParser()</span>
<span class="n">MyParser_t</span><span class="o">&amp;</span> <span class="n">utils</span><span class="o">::</span><span class="n">getParser</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">MyParser_t</span> <span class="n">p</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">MyParser</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">MyParser</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">p</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>On obtient le résulat suivant après l’exécution des tests:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="o">&gt;</span> <span class="nb">cd </span>build <span class="o">&amp;&amp;</span> cmake <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Debug ..
<span class="c">## truncated ##</span>
build&gt; cmake <span class="nt">--build</span> <span class="nb">.</span> <span class="nt">--config</span> Debug
<span class="c">## truncated ##</span>
build&gt; ../bin/Debug/toolset_test

<span class="o">==========]</span> Running 5 tests from 2 <span class="nb">test </span>suites.
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> Global <span class="nb">test </span>environment set-up.
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> 2 tests from ParserTest
<span class="o">[</span> RUN      <span class="o">]</span> ParserTest.Parser_LowerSingleLetter
<span class="o">[</span>       OK <span class="o">]</span> ParserTest.Parser_LowerSingleLetter <span class="o">(</span>0 ms<span class="o">)</span>
<span class="o">[</span> RUN      <span class="o">]</span> ParserTest.Parser_UpperSingleLetter
<span class="o">[</span>       OK <span class="o">]</span> ParserTest.Parser_UpperSingleLetter <span class="o">(</span>0 ms<span class="o">)</span>
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> 2 tests from ParserTest <span class="o">(</span>0 ms total<span class="o">)</span>

<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> 3 tests from UniqueParserTest
<span class="o">[</span> RUN      <span class="o">]</span> UniqueParserTest.Parser_UniqueParserIsUnique
<span class="o">[</span>       OK <span class="o">]</span> UniqueParserTest.Parser_UniqueParserIsUnique <span class="o">(</span>0 ms<span class="o">)</span>
<span class="o">[</span> RUN      <span class="o">]</span> UniqueParserTest.Parser_UniqueParserLowerSingleLetter
<span class="o">[</span>       OK <span class="o">]</span> UniqueParserTest.Parser_UniqueParserLowerSingleLetter <span class="o">(</span>0 ms<span class="o">)</span>
<span class="o">[</span> RUN      <span class="o">]</span> UniqueParserTest.Parser_UniqueParserUpperSingleLetter
<span class="o">[</span>       OK <span class="o">]</span> UniqueParserTest.Parser_UniqueParserUpperSingleLetter <span class="o">(</span>0 ms<span class="o">)</span>
<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> 3 tests from UniqueParserTest <span class="o">(</span>0 ms total<span class="o">)</span>

<span class="o">[</span><span class="nt">----------</span><span class="o">]</span> Global <span class="nb">test </span>environment tear-down
<span class="o">[==========]</span> 5 tests from 2 <span class="nb">test </span>suites ran. <span class="o">(</span>0 ms total<span class="o">)</span>
<span class="o">[</span>  PASSED  <span class="o">]</span> 5 tests.
</pre></table></code></div></div><p>Le refactoring et l’ajout de la fonction se sont bien déroulés et l’ensemble des tests unitaires définis depuis le début permettent de controler la qualité du code tout au long de la production. Ce qui me permet d’insister sur un aspect intéressant de l’approche TDD : les tests ne sont pas jettables — on peut les faire évoluer, comme tout à l’heure avec l’ajout du namespace, mais ce serait dommage de les supprimer car il permettent de contrôler la qualité du code.</p><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Le TDD est une approche et pas une technique toute faite. Ce qui signifie qu’il faut s’exercer sur des projets avec rigueur et patience. Plus on s’exerce, plus on a de bons réflexes.</p><p>Même si les styles de programmation et les langages varient et qu’il est difficile de faire des généralités, on peut quand même définir quelques bonnes pratiques, valables pour tout type de projet. J’en cite 3 :</p><ul><li>les tests doivent êtres simples et exprimables en langage naturel<li>on doit absolument s’interdire de faire évoluer le code sans avoir défini les tests qui permettront de valider la production<li>il faut diversifier au maximum l’objet des tests (ne pas tester les mêmes choses) — ce qui sera possible en envisageant le maximum de cas d’usage possible. Le lecteur pourra consulter les ouvrages sur le sujet pour se faire une idée plus complète des <a href="https://en.wikipedia.org/wiki/Test-driven_development" title="Wikipedia : Le Test-Driven Development (TDD), ou développement piloté par les tests en français, est une méthode de développement de logiciel qui consiste à concevoir un logiciel par petites étapes, de façon progressive, en écrivant avant chaque partie du code source propre au logiciel les tests correspondants et en remaniant le code continuellement.">méthologies TDD</a>.</ul><p>Le code utilisé dans le post est disponible <a href="https://github.com/kanmeugne/cppexperiments/releases/tag/starting-the-cycle" title="The source code of this tutorial is forkable from here">ici</a>. J’attends vos commentaires…</p><h2 id="resources"><span class="mr-2">Resources</span><a href="#resources" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://cmake.org/cmake/help/v3.8/" title="CMake est un système de construction logicielle multiplateforme">CMake.org</a><li><a href="https://git-scm.com/" title="Git est un logiciel de gestion de versions décentralisé">Git : official Website</a><li><a href="https://github.com/google/googletest" title="GoogleTest is Google’s C++ testing and mocking framework">GitHub.com/google/googletest</a><li><a href="https://crascit.com/2015/07/25/cmake-gte" title="Crascit : Building GoogleTest and GoogleMock directly in a CMake project">Crascit.com : cmake-gte</a><li><a href="https://docs.microsoft.com/en-us/cpp/build/cmake-projects-in-visual-studio" title="CMake est devenu de plus en plus intégré à Visual Studio au cours des dernières versions">docs.microsoft.com : CMake projects in visual studio</a><li><a href="https://en.wikipedia.org/wiki/Test-driven_development" title="Wikipedia : Le Test-Driven Development (TDD), ou développement piloté par les tests en français, est une méthode de développement de logiciel qui consiste à concevoir un logiciel par petites étapes, de façon progressive, en écrivant avant chaque partie du code source propre au logiciel les tests correspondants et en remaniant le code continuellement.">Wikipedia : Test-driven development</a><li><a href="https://github.com/kanmeugne/cppexperiments/releases/tag/starting-the-cycle" title="The source code of this tutorial is forkable from here">Kanmeugne’s Blog : Introduction au TDD (II) – le cycle vertueux (code source)</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/software-development/'>software development</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cmake/" class="post-tag no-text-decoration" >cmake</a> <a href="/tags/c/" class="post-tag no-text-decoration" >c++</a> <a href="/tags/tdd/" class="post-tag no-text-decoration" >tdd</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Introduction+au+TDD+%28II%29+%3A+le+cycle+vertueux+-+Kanmeugne%27s+Blog&url=https%3A%2F%2Fkanmeugne.github.io%2Fposts%2Ftdd-cycle-vertueux%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Introduction+au+TDD+%28II%29+%3A+le+cycle+vertueux+-+Kanmeugne%27s+Blog&u=https%3A%2F%2Fkanmeugne.github.io%2Fposts%2Ftdd-cycle-vertueux%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fkanmeugne.github.io%2Fposts%2Ftdd-cycle-vertueux%2F&text=Introduction+au+TDD+%28II%29+%3A+le+cycle+vertueux+-+Kanmeugne%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/hadoop-and-hive/">Hadoop : query data from a self-hosted hadoop cluster</a><li><a href="/posts/hadoop-map-reduce-using-python/">Hadoop : Map/Reduce Using Python</a><li><a href="/posts/postgresql-and-apache-superset/">Apache Superset and Postgresql : connecting your database to a powerful data visualisation engine</a><li><a href="/posts/2d-grid-obstacles/">2D Grid with obstacles</a><li><a href="/posts/pheromons-evaporation/">Pheromon evaporation on a 2D Grid</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/cmake/">cmake</a> <a class="post-tag" href="/tags/modeling/">modeling</a> <a class="post-tag" href="/tags/sfml/">sfml</a> <a class="post-tag" href="/tags/apache/">apache</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/simulation/">simulation</a> <a class="post-tag" href="/tags/solution-architect/">solution architect</a> <a class="post-tag" href="/tags/hive/">hive</a> <a class="post-tag" href="/tags/ipython/">ipython</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/introduction-tdd-googletest/"><div class="card-body"> <em class="small" data-ts="1635436800" data-df="ll" > Oct 29, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Introduction au TDD (I) : Mise en place avec googletest</h3><div class="text-muted small"><p> Le TDD — abbréviation de Test-Driven Development — fait référence à une approche de developpement informatique dans laquelle le code est toujours produit dans le but de valider des tests préalablem...</p></div></div></a></div><div class="card"> <a href="/posts/2d-grid-obstacles/"><div class="card-body"> <em class="small" data-ts="1601740800" data-df="ll" > Oct 4, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>2D Grid with obstacles</h3><div class="text-muted small"><p> Using a regular 2D Grid to model the navigable space is a good choice if you want to simulate moving agents (ex: vehicules, pedestrians). In fact, 2D Grids can be seen as partitions of the space an...</p></div></div></a></div><div class="card"> <a href="/posts/pheromons-evaporation/"><div class="card-body"> <em class="small" data-ts="1602432000" data-df="ll" > Oct 12, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pheromon evaporation on a 2D Grid</h3><div class="text-muted small"><p> You should now be familiar with our 2D Grid app. In a previous post, I updated its original object-oriented architecture in order to implement an affordable obstacle feature. Here, I am going to up...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/introduction-tdd-googletest/" class="btn btn-outline-primary" prompt="Older"><p>Introduction au TDD (I) : Mise en place avec googletest</p></a> <a href="/posts/setting-up-your-python-environment/" class="btn btn-outline-primary" prompt="Newer"><p>Setting Up Your Python Environment (I)</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "kanmeugne/kanmeugne.github.io", "data-repo-id": "MDEwOlJlcG9zaXRvcnkyOTc1NjcwMjA=", "data-category": "General", "data-category-id": "DIC_kwDOEbyDLM4CPQDi", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/patricksimok">Patrick S. Kanmeugne</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/cmake/">cmake</a> <a class="post-tag" href="/tags/modeling/">modeling</a> <a class="post-tag" href="/tags/sfml/">sfml</a> <a class="post-tag" href="/tags/apache/">apache</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/simulation/">simulation</a> <a class="post-tag" href="/tags/solution-architect/">solution architect</a> <a class="post-tag" href="/tags/hive/">hive</a> <a class="post-tag" href="/tags/ipython/">ipython</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-KFTQ8M8D5N"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KFTQ8M8D5N'); }); </script>
